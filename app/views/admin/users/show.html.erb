<% content_for :meta_title, t('.title', name: @entity.profile_name) %>
<% content_for :breadcrumbs do %>
    <%= link_to(t('admin.users.nav_item.text'), admin_users_path) %>
    <span><%= @entity.profile_name %></span>
<% end %>

<% profile = @entity.data['profile'] %>
<article class="entity-page">
  <h1><%= @entity.long_slug %></h1>
  <% if @entity.deleted? %>
      <div class="alert"><%= t(:deleted_entity) %></div>
  <% end %>
  <ul class="actions">
    <li><%= back_icon admin_users_path %></li>
    <li><%= create_icon new_user_path %></li>
    <% unless @entity.deleted? %>
        <li><%= edit_icon edit_user_path(id: @entity) %></li>
    <% end %>
  </ul>

  <table>
    <tbody>
    <tr>
      <td colspan="2">
        <figure>
          <%= profile_avatar @entity %>
        </figure>
      </td>
    </tr>
    <% unless @entity.notice.blank? %>
        <tr>
          <th><%= t('activerecord.attributes.user.notice') %></th>
          <td><%= @entity.notice %></td>
        </tr>
    <% end %>
    <tr>
      <th><%= t('activerecord.attributes.user.slug') %></th>
      <td><%= @entity.slug %></td>
    </tr>
    <tr>
      <th><%= t('activerecord.attributes.user.screen_name') %></th>
      <td><%= @entity.screen_name %> (<%= user_link @entity %>)</td>
    </tr>
    <% unless profile['surname'].blank? %>
        <tr>
          <th><%= t('activerecord.attributes.user_profile.surname') %></th>
          <td><%= profile['surname'] %></td>
        </tr>
    <% end %>
    <% unless profile['name'].blank? %>
        <tr>
          <th><%= t('activerecord.attributes.user_profile.name') %></th>
          <td><%= profile['name'] %></td>
        </tr>
    <% end %>
    <% unless profile['patronymic'].blank? %>
        <tr>
          <th><%= t('activerecord.attributes.user_profile.patronymic') %></th>
          <td><%= profile['patronymic'] %></td>
        </tr>
    <% end %>
    <% unless @entity.email.blank? %>
        <tr>
          <th><%= t('activerecord.attributes.user.email') %></th>
          <td><%= link_to @entity.email, "mailto:#{@entity.email}" %></td>
        </tr>
    <% end %>
    <% unless @entity.phone.blank? %>
        <tr>
          <th><%= t('activerecord.attributes.user.phone') %></th>
          <td><%= link_to @entity.phone, "tel:#{@entity.phone}" %></td>
        </tr>
    <% end %>
    <tr>
      <th><%= t('activerecord.attributes.user_profile.gender') %></th>
      <td><%= gender_name(profile['gender']) %></td>
    </tr>
    <% unless @entity.ip.blank? %>
        <tr>
          <th><%= t('activerecord.attributes.user.ip') %></th>
          <td><%= @entity.ip %></td>
        </tr>
    <% end %>
    <tr>
      <th><%= t(:created_at) %></th>
      <td><%= time_tag @entity.created_at %></td>
    </tr>
    <tr>
      <th><%= t(:updated_at) %></th>
      <td><%= time_tag @entity.updated_at %></td>
    </tr>
    <% unless @entity.last_seen.blank? %>
        <tr>
          <th><%= t('activerecord.attributes.user.last_seen') %></th>
          <td><%= time_tag @entity.last_seen %></td>
        </tr>
    <% end %>
    <% if @entity.privileges.any? %>
        <tr>
          <th><%= t('.privileges') %></th>
          <td>
            <ul>
              <% @entity.privileges.ordered_by_priority.each do |privilege| %>
                  <li><%= admin_privilege_link(privilege) %></li>
              <% end %>
            </ul>
          </td>
        </tr>
    <% end %>
    <tr>
      <td colspan="2">
        <ul>
          <li><%= link_to t('admin.users.privileges.heading'), privileges_admin_user_path(id: @entity.id) %></li>
          <li><%= link_to t('admin.tokens.index.heading'), tokens_admin_user_path(id: @entity) %></li>
          <li><%= link_to t('admin.codes.index.heading'), codes_admin_user_path(id: @entity) %></li>
          <% unless @entity == current_user %>
              <li><%= link_to t('.authenticate'), authenticate_admin_user_path(id: @entity.id), method: :post %></li>
          <% end %>
        </ul>
      </td>
    </tr>
    </tbody>
    <% unless @entity.deleted? %>
        <tfoot>
        <tr>
          <td colspan="2">
            <%= render partial: 'shared/admin/toggleable', locals: { entity: @entity, url: toggle_admin_user_path(id: @entity.id) } %>
          </td>
        </tr>
        </tfoot>
    <% end %>
  </table>

  <% if @entity.user_privileges.any? %>
      <dl>
        <dt><%= t('.privileges') %></dt>
        <dd>
          <ol>
            <% @entity.user_privileges.order('privilege_id, region_id asc nulls first').each do |link| %>
                <li>
                  <%= link.privilege.name %>
                  <% unless link.region.nil? %>
                      (<%= link.region.branch_name %>)
                  <% end %>
                </li>
            <% end %>
          </ol>
        </dd>
      </dl>
  <% end %>

</article>
