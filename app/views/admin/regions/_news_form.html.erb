<%= radio_button_tag 'news[region_id]', '', false, id: 'news_region_other' %>
<%= label_tag 'news_region_other', 'Новый регион' %>

<div id="news-regions-selector" data-url="<%= regions_admin_news_index_path %>">
</div>
<script>
    'use strict';

    $(function () {
        let $container = $('#news-regions-selector');
        let $selector = $('#news_region_other');
        let $label = $selector.find('+ label');

        $selector.on('click', function () {
            if ($container.children().length < 1) {
                $.get($container.data('url'), function (response) {
                    if (response.hasOwnProperty('data')) {
                        let $select = $('<select>');

                        $select.append('<option>Не выбрано</option>');

                        $(response['data']).each(function (i, option) {
                            $select.append(option['meta']['html_chunk']);
                        });

                        $container.append($select);
                    }
                }).fail(handle_ajax_failure);
            }
        });

        $container.on('change', 'select', function () {
            let $select = $(this);

            $selector.val($(this).val());
            $label.html($(this).find(':selected').data('name'));

            if ($(this).val() !== "") {
                $select.find('~ select').remove();
                $.get($container.data('url'), { parent_id: $(this).val() }, function(response) {
                    if (response.hasOwnProperty('data') && response['data'].length > 0) {
                        let $children = $('<select>');

                        $children.append('<option>Дочерние регионы</option>');

                        $(response['data']).each(function (i, option) {
                            $children.append(option['meta']['html_chunk']);
                        });

                        $container.append($children);
                    }
                }).fail(handle_ajax_failure);
            }
        });
    });
</script>